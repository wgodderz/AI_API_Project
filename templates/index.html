<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AI Study Buddy Times</title>
  <link rel="stylesheet" href="/static/style.css">
  <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'EB Garamond', Georgia, serif;
      background: url('https://www.transparenttextures.com/patterns/white-wall-3.png');
      color: #1a1a1a;
      margin: 0;
      padding: 0;
    }

    header {
      background-color: #f5f5f5;
      padding: 30px 0 10px;
      border-bottom: 2px solid #ccc;
      text-align: center;
    }

    header h1 {
      font-size: 3.2em;
      margin: 0;
      letter-spacing: 1.5px;
    }

    .date-line {
      font-size: 1em;
      color: #666;
      margin-top: 8px;
      font-style: italic;
    }

    .translate-bar {
      margin-top: 10px;
      text-align: center;
    }

    .translate-bar select,
    .translate-bar button {
      font-size: 0.9em;
      padding: 6px 10px;
      margin: 5px;
      cursor: pointer;
    }

    .newspaper {
      max-width: 1300px;
      margin: 30px auto;
      display: flex;
      gap: 36px;
      padding: 0 40px;
    }

    .column {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 30px;
    }

    .section-label {
      font-size: 0.85em;
      color: #555;
      letter-spacing: 1px;
      text-transform: uppercase;
      margin-bottom: -15px;
      margin-top: 10px;
      border-bottom: 1px dotted #bbb;
    }

    section.article-section {
      break-inside: avoid;
      background: #fff;
      padding: 5px 10px 20px;
      transition: 0.3s;
      border: 1px solid #ccc;
    }

    section.article-section:nth-child(even) {
      background: #fefefe;
      border: 1px double #aaa;
    }

    section.article-section:hover {
      background-color: #f9f9f9;
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
    }

    section.article-section p:first-letter {
      float: left;
      font-size: 2.4em;
      line-height: 1;
      padding-right: 8px;
      font-weight: bold;
    }

    h2 {
      font-size: 1.3em;
      border-bottom: 1px solid #999;
      margin-bottom: 5px;
      padding-bottom: 4px;
      font-weight: 700;
    }

    .byline {
      font-size: 0.75em;
      color: #666;
      margin-bottom: 10px;
      display: block;
      font-style: italic;
    }

    p, li {
      text-align: justify;
      line-height: 1.6;
      font-size: 1em;
    }

    footer {
      text-align: center;
      font-size: 0.9em;
      color: #888;
      border-top: 1px solid #ccc;
      margin-top: 60px;
      padding: 20px 0;
    }

    .article-section img {
      width: 100%;
      height: auto;
      margin-bottom: 10px;
      border: 1px solid #999;
    }

    @media (max-width: 900px) {
      .newspaper {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <header>
    <h1>üì∞ AI Willis Times</h1>
    <div class="date-line">Thursday, July 25, 2025</div>
    <div class="translate-bar">
      <select id="languageSelect">
        <option value="en">English</option>
        <option value="es">Spanish</option>
        <option value="fr">French</option>
        <option value="de">German</option>
        <option value="ja">Japanese</option>
      </select>
      <button onclick="translatePage()">üåê Translate</button>
    </div>
  </header>

  <div class="newspaper">
    <div class="column">
      <h3 class="section-label">Productivity</h3>
      <section class="article-section">
        <h2>üìù Summarize Your Notes</h2>
        <img src="https://th.bing.com/th?q=Student+Writing+Essay+Cartoon&w=120&h=120&c=1&rs=1&qlt=90&r=0&cb=1&pid=InlineBlock&mkt=en-US&cc=US&setlang=en&adlt=strict&t=1&mw=247" alt="Writing cartoon">
        <form id="text-form">
          <textarea name="text" rows="8" placeholder="Paste your notes here..."></textarea>
          <button type="submit">Summarize</button>
        </form>
        <div id="output"></div>
      </section>
      <section class="article-section">
        <h2>üí™ Custom Workout Generator</h2>
        <img src="https://th.bing.com/th/id/OIP.d1UFuHwAf0sDgp_oqYeyQwHaE8?w=227&h=180&c=7&r=0&o=7&pid=1.7&rm=3" alt="Workout Plan">
        <input type="text" id="muscleInput" placeholder="Enter muscle group (e.g. chest)">
        <button onclick="getWorkout()">Get Workout Plan</button>
        <ul id="workoutResultsList"></ul>
      </section>
    </div>

    <div class="column">
      <h3 class="section-label">Entertainment</h3>
      <section class="article-section">
        <h2>üéß Vibe-Based Song Finder</h2>
        <img src="https://retailwire.com/wp-content/uploads/Spotify-Photo-by-Bastian-Riccardi-on-Unsplash-scaled.jpg" alt="Spotify vibe image">
        <form id="vibe-form" method="post">
          <input type="text" name="vibe" placeholder="Enter a vibe (e.g. gym, chill, drake)">
          <button type="submit">Find Song</button>
        </form>
        <div id="playlist-result"></div>
      </section>

      <section class="article-section">
        <h2>üèÄ Sports Highlight Recommendations</h2>
        <img src="https://th.bing.com/th/id/R.47a2d030a52e6caf41d1c3f2990f9f30?rik=gnFXoFK%2frqcZeg&pid=ImgRaw&r=0" alt="LeBron Highlights">
        <input id="highlight-query" placeholder="Enter player, team, or sport...">
        <button onclick="fetchHighlights()">Get Highlights</button>
        <div id="highlight-results"></div>
      </section>
    </div>

    <div class="column">
      <h3 class="section-label">Health & Rankings</h3>
      <section class="article-section">
        <h2>üçé Calorie & Nutrition Info</h2>
        <form id="calorie-form">
          <input type="text" id="food-input" placeholder="e.g. chicken breast" required>
          <button type="submit">Get Nutrition Info</button>
        </form>
        <div id="calorie-result"></div>
      </section>

      <section class="article-section">
        <h2>üèÜ Top 10 Rankings</h2>
        <img src="https://th.bing.com/th/id/OIP.V7wpOwxUd4vlBxkxlhEr0QAAAA?w=143&h=187&c=7&r=0&o=7&pid=1.7&rm=3" alt="Top 10 Trophy">
        <input type="text" id="top10-input" placeholder="e.g. basketball players">
        <button onclick="getTop10()">Get Top 10</button>
        <pre id="top10-output"></pre>
      </section>

      <section class="article-section">
        <h2>üìà Stock Market Movers</h2>
        <img src="https://th.bing.com/th?id=OIF.FVf%2b2vEYitNogNCiWoCMDg&r=0" alt="Stock Market">
        <button onclick="getStockMovers()">Get Top Gainers & Losers</button>
        <div id="stock-movers-output">
          <h4>Top Gainers:</h4>
          <ul id="gainers-list"></ul>
          <h4>Top Losers:</h4>
          <ul id="losers-list"></ul>
        </div>
      </section>
</div> 
</div> 
  <footer>
    &copy; 2025 WILLIS Times. All rights reserved.
  </footer>

    <script> //start ther JavaScript code
    document.getElementById("text-form").addEventListener("submit", async function(e) { // listens for the form submission
        e.preventDefault(); //stops form from doing defult action of reloadig the page
        const notes = new FormData(this); //creats a formdata object from the form (this is the notes)
        const response = await fetch("/summarize", { //sends the form data to the flask backend
            method: "POST", // uses POST = send
            body: notes //the body is the form data aka the notes that the user inputted
        });
        const result = await response.json(); //converts the response from JSON format to regular JavaScript object
        document.getElementById("output").innerText = result.summary || result.error; //displays the summary or error in the output div line 13
    });

    document.getElementById("vibe-form").addEventListener("submit", async function(e) { //listens for the vibe form submission
        e.preventDefault(); //stops form from doing default action of reloading the page
        const formData = new FormData(this); //create a formdata object from the vibe form
        const res = await fetch("/get_song", { //send form data to flask backend
            method: "POST",
            body: formData
        });
        const data = await res.json(); //convert the response from JSON format
        const container = document.getElementById("playlist-result"); //get the div where we'll display result

        if (data.url) { //check if the response contains a URL
            const trackId = data.url.split("/track/").pop().split("?")[0]; //get the track ID from the URL
            container.innerHTML = `
                <p>üéµ ${data.name} by ${data.artist}</p> 
                <iframe style="border-radius:12px" src="https://open.spotify.com/embed/track/${trackId}" width="100%" height="152" frameBorder="0" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"></iframe>
            `;
        } else {
            container.textContent = data.error; //show error if no song found
        }
    });

    function fetchHighlights() {
    const query = document.getElementById("highlight-query").value.trim();
    const container = document.getElementById("highlight-results");
    container.innerHTML = "<p>Loading...</p>";

    fetch("/get_sports_highlights", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ query: query })
    })
    .then(res => res.json())
    .then(data => {
        container.innerHTML = "";
        if (data.error) {
            container.innerHTML = `<p style="color:red;">${data.error}</p>`;
            return;
        }
        data.forEach(vid => {
            container.innerHTML += `
                <div style="margin-bottom: 20px;">
                    <a href="${vid.videoUrl}" target="_blank" style="text-decoration: none; color: black;">
                        <img src="${vid.thumbnail}" width="320" style="border-radius: 8px;"><br>
                        <strong>${vid.title}</strong>
                    </a>
                </div>
            `;
        });
    })
    .catch(() => {
        container.innerHTML = "<p style='color:red;'>Something went wrong while fetching highlights.</p>";
    });
}

    function convertToSpeech() {
    const text = document.getElementById("tts-input").value.trim();
    const audio = document.getElementById("tts-audio");

    if (!text) {
        alert("Please enter some text to convert to speech.");
        return;
    }

    fetch("/text-to-speech", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ text: text })
    })
    .then(res => res.json())
    .then(data => {
        if (data.audio) {
            audio.src = "data:audio/mp3;base64," + data.audio;
            audio.play();
        } else {
            alert("Error: " + data.error);
        }
    })
    .catch(() => {
        alert("Something went wrong while processing the speech request.");
    });
}

function getPlacesByCity() {
    const city = document.getElementById("cityInput").value;
    const keyword = document.getElementById("cityKeywordInput").value;

    fetch("/get_places_by_city", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ city, keyword })
    })
    .then(res => res.json())
    .then(data => {
        const list = document.getElementById("cityResultsList");
        list.innerHTML = "";

        if (data.error) {
            list.innerHTML = `<li>${data.error}</li>`;
            return;
        }

        if (data.length === 0) {
            list.innerHTML = "<li>No places found.</li>";
            return;
        }

        data.forEach(place => {
            const item = document.createElement("li");
            item.textContent = `${place.name} - ${place.address || "Address not available"} (Rating: ${place.rating || "N/A"})`;
            list.appendChild(item);
        });
    });
}

function getWorkout() {
    const muscle = document.getElementById("muscleInput").value;
    const list = document.getElementById("workoutResultsList");
    list.innerHTML = "<li>Loading...</li>";

    fetch("/get_workout", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ muscle: muscle })
    })
    .then(res => res.json())
    .then(data => {
        list.innerHTML = "";

        if (data.error) {
            list.innerHTML = `<li>${data.error}</li>`;
            return;
        }

        data.forEach(exercise => {
            const item = document.createElement("li");
            item.innerHTML = `<strong>${exercise.name}</strong> ‚Äî ${exercise.instructions}`;
            list.appendChild(item);
        });
    })
    .catch(() => {
        list.innerHTML = "<li>Something went wrong while fetching your workout.</li>";
    });
}

document.getElementById("calorie-form").addEventListener("submit", async (e) => {
    e.preventDefault();
    const food = document.getElementById("food-input").value.trim();
    const resultDiv = document.getElementById("calorie-result");
    resultDiv.innerHTML = "Loading...";

    try {
      const response = await fetch("/get_calories", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ food })
      });

      const data = await response.json();

      if (data.error) {
        resultDiv.innerHTML = `<p>‚ö†Ô∏è ${data.error}</p>`;
      } else {
        resultDiv.innerHTML = `
          <h3>${data.name}</h3>
          <ul>
            <li><strong>Calories:</strong> ${data.calories}</li>
            <li><strong>Protein:</strong> ${data.protein} g</li>
            <li><strong>Carbs:</strong> ${data.carbohydrates} g</li>
            <li><strong>Fat:</strong> ${data.fat} g</li>
          </ul>
        `;
      }
    } catch (err) {
      resultDiv.innerHTML = `<p>‚ùå Something went wrong. Try again later.</p>`;
    }
  });

  function getTop10() {
    const category = document.getElementById("top10-input").value.trim();
    const output = document.getElementById("top10-output");

    if (!category) {
        output.innerText = "Please enter a category.";
        return;
    }

    output.innerText = "Loading...";

    fetch("/top10", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ category })
    })
    .then(res => res.json())
    .then(data => {
        if (data.error) {
            output.innerText = `‚ùå ${data.error}`;
        } else {
            output.innerText = `Top 10 ${category}:\n\n${data.top10}`;
        }
    })
    .catch(() => {
        output.innerText = "Something went wrong. Try again later.";
    });
}

function getStockMovers() {
  document.getElementById("gainers-list").innerHTML = "Loading...";
  document.getElementById("losers-list").innerHTML = "";

  fetch("/top_stocks")
    .then(res => res.json())
    .then(data => {
      const gainers = data.gainers || [];
      const losers = data.losers || [];

      const gainersList = gainers.map(s => `<li>${s.symbol} (${s.change_percent}%)</li>`).join("");
      const losersList = losers.map(s => `<li>${s.symbol} (${s.change_percent}%)</li>`).join("");

      document.getElementById("gainers-list").innerHTML = gainersList;
      document.getElementById("losers-list").innerHTML = losersList;
    })
    .catch(err => {
      document.getElementById("gainers-list").innerHTML = `<li>Error: ${err.message}</li>`;
    });
}

function translatePage() {
  const targetLang = document.getElementById("languageSelect").value;

  // Walk the DOM and collect all visible text nodes
  const walker = document.createTreeWalker(document.body, NodeFilter.SHOW_TEXT);
  const textNodes = [];
  while (walker.nextNode()) {
    const node = walker.currentNode;
    if (node.nodeValue.trim() && node.parentNode.offsetParent !== null) {
      textNodes.push(node);
    }
  }

  textNodes.forEach(async (node) => {
    const originalText = node.nodeValue.trim();

    try {
      const res = await fetch("/translate", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ text: originalText, target: targetLang })
      });

      const data = await res.json();
      if (data.translated_text) {
        node.nodeValue = data.translated_text;
      }
    } catch (err) {
      console.error("Translation error:", err);
    }
  });
}
</script>
</body>
</html>