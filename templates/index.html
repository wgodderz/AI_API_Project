<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Study Buddy Times</title>
  <link rel="stylesheet" href="/static/style.css">
  <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Merriweather', serif;
      background-color: #f9f9f9;
      padding: 20px;
    }
    h1 {
      text-align: center;
      font-size: 2.8rem;
      margin-bottom: 30px;
    }
    .grid-container {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 24px 32px;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px 40px;
    }
    .article-section {
      background: #fff;
      border: 1px solid #ddd;
      padding: 16px 20px;
      font-size: 0.95rem;
    }
    h2 {
      font-size: 1.2rem;
      margin-bottom: 12px;
      font-weight: 700;
      border-bottom: 1px solid #aaa;
      padding-bottom: 4px;
    }
    input, textarea, button, select {
      font-family: inherit;
      font-size: 1rem;
      padding: 6px;
      margin: 4px 0;
      width: 100%;
      box-sizing: border-box;
    }
    button {
      background: #111;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background: #333;
    }
    audio {
      margin-top: 10px;
    }
    .span-2 {
      grid-column: span 2;
    }
    .span-3 {
      grid-column: span 3;
    }
  </style>
</head>
<body>
  <h1>üì∞ Willis Times</h1>
  <div class="grid-container">
    <section class="article-section span-2">
      <h2>üìù Summarize Your Notes</h2>
      <form id="text-form">
        <textarea name="text" rows="8" placeholder="Paste your notes here..."></textarea>
        <button type="submit">Summarize</button>
      </form>
      <div id="output"></div>
    </section>

    <section class="article-section">
      <h2>üéß Vibe-Based Song Finder</h2>
      <form id="vibe-form" method="post">
        <input type="text" name="vibe" placeholder="Enter a vibe (e.g. gym, chill, drake)">
        <button type="submit">Find Song</button>
      </form>
      <div id="playlist-result"></div>
    </section>

    <section class="article-section">
      <h2>üèÄ Sports Highlight Recommendations</h2>
      <input id="highlight-query" placeholder="Enter player, team, or sport...">
      <button onclick="fetchHighlights()">Get Highlights</button>
      <div id="highlight-results"></div>
    </section>

    <section class="article-section">
      <h2>üó£Ô∏è Text-to-Speech</h2>
      <textarea id="tts-input" rows="5" placeholder="Type something to speak..."></textarea>
      <button onclick="convertToSpeech()">Speak</button>
      <audio id="tts-audio" controls></audio>
    </section>

    <section class="article-section">
      <h2>üìç Explore Places in Any City</h2>
      <input type="text" id="cityInput" placeholder="Enter city (e.g., Chicago)">
      <input type="text" id="cityKeywordInput" placeholder="Enter keyword (e.g., pizza)">
      <button onclick="getPlacesByCity()">Find Places</button>
      <ul id="cityResultsList"></ul>
    </section>

    <section class="article-section">
      <h2>üí™ Custom Workout Generator</h2>
      <input type="text" id="muscleInput" placeholder="Enter muscle group (e.g. chest)">
      <button onclick="getWorkout()">Get Workout Plan</button>
      <ul id="workoutResultsList"></ul>
    </section>

    <section class="article-section">
      <h2>üçé Calorie & Nutrition Info</h2>
      <form id="calorie-form">
        <input type="text" id="food-input" placeholder="e.g. chicken breast" required>
        <button type="submit">Get Nutrition Info</button>
      </form>
      <div id="calorie-result"></div>
    </section>

    <section class="article-section">
      <h2>üèÜ Top 10 Rankings</h2>
      <input type="text" id="top10-input" placeholder="e.g. basketball players">
      <button onclick="getTop10()">Get Top 10</button>
      <pre id="top10-output"></pre>
    </section>

    <section class="article-section span-2">
      <h2>üìà Top Stock Movers Today</h2>
      <button onclick="loadStocks()">Show Gainers & Losers</button>
      <div id="stocks-section">
        <h3>Top Gainers</h3>
        <ul id="gainers-list"></ul>
        <h3>Top Losers</h3>
        <ul id="losers-list"></ul>
      </div>
    </section>

    <section class="article-section">
      <h2>üåê Translate This Page</h2>
      <select id="languageSelect">
        <option value="en">English</option>
        <option value="es">Spanish</option>
        <option value="fr">French</option>
        <option value="de">German</option>
        <option value="ja">Japanese</option>
      </select>
      <button onclick="translatePage()">Translate</button>
    </section>
  </div>

    <script> //start ther JavaScript code
    document.getElementById("text-form").addEventListener("submit", async function(e) { // listens for the form submission
        e.preventDefault(); //stops form from doing defult action of reloadig the page
        const notes = new FormData(this); //creats a formdata object from the form (this is the notes)
        const response = await fetch("/summarize", { //sends the form data to the flask backend
            method: "POST", // uses POST = send
            body: notes //the body is the form data aka the notes that the user inputted
        });
        const result = await response.json(); //converts the response from JSON format to regular JavaScript object
        document.getElementById("output").innerText = result.summary || result.error; //displays the summary or error in the output div line 13
    });

    document.getElementById("vibe-form").addEventListener("submit", async function(e) { //listens for the vibe form submission
        e.preventDefault(); //stops form from doing default action of reloading the page
        const formData = new FormData(this); //create a formdata object from the vibe form
        const res = await fetch("/get_song", { //send form data to flask backend
            method: "POST",
            body: formData
        });
        const data = await res.json(); //convert the response from JSON format
        const container = document.getElementById("playlist-result"); //get the div where we'll display result

        if (data.url) { //check if the response contains a URL
            const trackId = data.url.split("/track/").pop().split("?")[0]; //get the track ID from the URL
            container.innerHTML = `
                <p>üéµ ${data.name} by ${data.artist}</p> 
                <iframe style="border-radius:12px" src="https://open.spotify.com/embed/track/${trackId}" width="100%" height="152" frameBorder="0" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"></iframe>
            `;
        } else {
            container.textContent = data.error; //show error if no song found
        }
    });

    function fetchHighlights() {
    const query = document.getElementById("highlight-query").value.trim();
    const container = document.getElementById("highlight-results");
    container.innerHTML = "<p>Loading...</p>";

    fetch("/get_sports_highlights", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ query: query })
    })
    .then(res => res.json())
    .then(data => {
        container.innerHTML = "";
        if (data.error) {
            container.innerHTML = `<p style="color:red;">${data.error}</p>`;
            return;
        }
        data.forEach(vid => {
            container.innerHTML += `
                <div style="margin-bottom: 20px;">
                    <a href="${vid.videoUrl}" target="_blank" style="text-decoration: none; color: black;">
                        <img src="${vid.thumbnail}" width="320" style="border-radius: 8px;"><br>
                        <strong>${vid.title}</strong>
                    </a>
                </div>
            `;
        });
    })
    .catch(() => {
        container.innerHTML = "<p style='color:red;'>Something went wrong while fetching highlights.</p>";
    });
}

    function convertToSpeech() {
    const text = document.getElementById("tts-input").value.trim();
    const audio = document.getElementById("tts-audio");

    if (!text) {
        alert("Please enter some text to convert to speech.");
        return;
    }

    fetch("/text-to-speech", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ text: text })
    })
    .then(res => res.json())
    .then(data => {
        if (data.audio) {
            audio.src = "data:audio/mp3;base64," + data.audio;
            audio.play();
        } else {
            alert("Error: " + data.error);
        }
    })
    .catch(() => {
        alert("Something went wrong while processing the speech request.");
    });
}

function getPlacesByCity() {
    const city = document.getElementById("cityInput").value;
    const keyword = document.getElementById("cityKeywordInput").value;

    fetch("/get_places_by_city", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ city, keyword })
    })
    .then(res => res.json())
    .then(data => {
        const list = document.getElementById("cityResultsList");
        list.innerHTML = "";

        if (data.error) {
            list.innerHTML = `<li>${data.error}</li>`;
            return;
        }

        if (data.length === 0) {
            list.innerHTML = "<li>No places found.</li>";
            return;
        }

        data.forEach(place => {
            const item = document.createElement("li");
            item.textContent = `${place.name} - ${place.address || "Address not available"} (Rating: ${place.rating || "N/A"})`;
            list.appendChild(item);
        });
    });
}

function getWorkout() {
    const muscle = document.getElementById("muscleInput").value;
    const list = document.getElementById("workoutResultsList");
    list.innerHTML = "<li>Loading...</li>";

    fetch("/get_workout", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ muscle: muscle })
    })
    .then(res => res.json())
    .then(data => {
        list.innerHTML = "";

        if (data.error) {
            list.innerHTML = `<li>${data.error}</li>`;
            return;
        }

        data.forEach(exercise => {
            const item = document.createElement("li");
            item.innerHTML = `<strong>${exercise.name}</strong> ‚Äî ${exercise.instructions}`;
            list.appendChild(item);
        });
    })
    .catch(() => {
        list.innerHTML = "<li>Something went wrong while fetching your workout.</li>";
    });
}

document.getElementById("calorie-form").addEventListener("submit", async (e) => {
    e.preventDefault();
    const food = document.getElementById("food-input").value.trim();
    const resultDiv = document.getElementById("calorie-result");
    resultDiv.innerHTML = "Loading...";

    try {
      const response = await fetch("/get_calories", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ food })
      });

      const data = await response.json();

      if (data.error) {
        resultDiv.innerHTML = `<p>‚ö†Ô∏è ${data.error}</p>`;
      } else {
        resultDiv.innerHTML = `
          <h3>${data.name}</h3>
          <ul>
            <li><strong>Calories:</strong> ${data.calories}</li>
            <li><strong>Protein:</strong> ${data.protein} g</li>
            <li><strong>Carbs:</strong> ${data.carbohydrates} g</li>
            <li><strong>Fat:</strong> ${data.fat} g</li>
          </ul>
        `;
      }
    } catch (err) {
      resultDiv.innerHTML = `<p>‚ùå Something went wrong. Try again later.</p>`;
    }
  });

  function getTop10() {
    const category = document.getElementById("top10-input").value.trim();
    const output = document.getElementById("top10-output");

    if (!category) {
        output.innerText = "Please enter a category.";
        return;
    }

    output.innerText = "Loading...";

    fetch("/top10", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ category })
    })
    .then(res => res.json())
    .then(data => {
        if (data.error) {
            output.innerText = `‚ùå ${data.error}`;
        } else {
            output.innerText = `Top 10 ${category}:\n\n${data.top10}`;
        }
    })
    .catch(() => {
        output.innerText = "Something went wrong. Try again later.";
    });
}

function loadStocks() {
  document.getElementById("gainers-list").innerHTML = "Loading...";
  document.getElementById("losers-list").innerHTML = "";

  fetch("/top_stocks")
    .then(res => res.json())
    .then(data => {
      const gainers = data.gainers || [];
      const losers = data.losers || [];

      const gainersList = gainers.map(s => `<li>${s.symbol} (${s.change_percent}%)</li>`).join("");
      const losersList = losers.map(s => `<li>${s.symbol} (${s.change_percent}%)</li>`).join("");

      document.getElementById("gainers-list").innerHTML = gainersList;
      document.getElementById("losers-list").innerHTML = losersList;
    })
    .catch(err => {
      document.getElementById("gainers-list").innerHTML = `<li>Error: ${err.message}</li>`;
    });
}

function translatePage() {
  const targetLang = document.getElementById("languageSelect").value;

  // Walk the DOM and collect all visible text nodes
  const walker = document.createTreeWalker(document.body, NodeFilter.SHOW_TEXT);
  const textNodes = [];
  while (walker.nextNode()) {
    const node = walker.currentNode;
    if (node.nodeValue.trim() && node.parentNode.offsetParent !== null) {
      textNodes.push(node);
    }
  }

  textNodes.forEach(async (node) => {
    const originalText = node.nodeValue.trim();

    try {
      const res = await fetch("/translate", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ text: originalText, target: targetLang })
      });

      const data = await res.json();
      if (data.translated_text) {
        node.nodeValue = data.translated_text;
      }
    } catch (err) {
      console.error("Translation error:", err);
    }
  });
}
</script>
</body>
</html>