<!DOCTYPE html> <!-- html file-->
<html> <!-- html begins-->
<head> <!-- head holds metadata (data about data) does not show on page -->
    <title>AI Study Buddy</title> <!-- title of the page and tab name -->
    <link rel="stylesheet" href="/static/style.css"> <!-- connects to style file-->
</head>
<body> <!-- starts visible page content-->
    <h1>AI Study Buddy</h1> <!-- main heading of page -->
    <form id="text-form"> <!-- form for user input -->
        <textarea name="text" rows="10" cols="80" placeholder="Paste your notes here..."></textarea><br> <!-- text area for user to input notes (creates text box)-->
        <button type="submit">Summarize</button> <!-- button to submit the form -->
    </form> <!-- end of form -->
    <div id="output"></div> <!-- empty box where error or summary will be-->
    <h2>üéß Vibe-Based Song Finder</h2>
    <form id="vibe-form" method="post">
        <input type="text" name="vibe" placeholder="Enter a vibe (e.g. gym, chill, drake)" />
        <button type="submit">Find Song</button>
    </form>
    <div id="playlist-result"></div>

    <section>
    <h2>üèÄ Sports Highlight Recommendations</h2>
    <input id="highlight-query" placeholder="Enter player, team, or sport..." style="width: 300px; padding: 8px;">
    <button onclick="fetchHighlights()" style="padding: 8px 12px;">Get Highlights</button>
    <div id="highlight-results" style="margin-top: 20px;"></div>
    </section>

    <section>
    <h2>üó£Ô∏è Text-to-Speech</h2>
    <textarea id="tts-input" rows="5" cols="80" placeholder="Type something to speak..."></textarea><br>
    <button onclick="convertToSpeech()">Speak</button>
    <br><br>
    <audio id="tts-audio" controls style="margin-top: 10px;"></audio>
    </section>

    <section>
    <h2>üìç Explore Places in Any City</h2>
    <div class="places-section">
    <input type="text" id="cityInput" placeholder="Enter city (e.g., Chicago)">
    <input type="text" id="cityKeywordInput" placeholder="Enter keyword (e.g., pizza)">
    <button onclick="getPlacesByCity()">Find Places by City</button>
    <ul id="cityResultsList"></ul>
    </div>
    </section>

    <script> //start ther JavaScript code
    document.getElementById("text-form").addEventListener("submit", async function(e) { // listens for the form submission
        e.preventDefault(); //stops form from doing defult action of reloadig the page
        const notes = new FormData(this); //creats a formdata object from the form (this is the notes)
        const response = await fetch("/summarize", { //sends the form data to the flask backend
            method: "POST", // uses POST = send
            body: notes //the body is the form data aka the notes that the user inputted
        });
        const result = await response.json(); //converts the response from JSON format to regular JavaScript object
        document.getElementById("output").innerText = result.summary || result.error; //displays the summary or error in the output div line 13
    });

    document.getElementById("vibe-form").addEventListener("submit", async function(e) { //listens for the vibe form submission
        e.preventDefault(); //stops form from doing default action of reloading the page
        const formData = new FormData(this); //create a formdata object from the vibe form
        const res = await fetch("/get_song", { //send form data to flask backend
            method: "POST",
            body: formData
        });
        const data = await res.json(); //convert the response from JSON format
        const container = document.getElementById("playlist-result"); //get the div where we'll display result

        if (data.url) { //check if the response contains a URL
            const trackId = data.url.split("/track/").pop().split("?")[0]; //get the track ID from the URL
            container.innerHTML = `
                <p>üéµ ${data.name} by ${data.artist}</p> 
                <iframe style="border-radius:12px" src="https://open.spotify.com/embed/track/${trackId}" width="100%" height="152" frameBorder="0" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"></iframe>
            `;
        } else {
            container.textContent = data.error; //show error if no song found
        }
    });

    function fetchHighlights() {
    const query = document.getElementById("highlight-query").value.trim();
    const container = document.getElementById("highlight-results");
    container.innerHTML = "<p>Loading...</p>";

    fetch("/get_sports_highlights", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ query: query })
    })
    .then(res => res.json())
    .then(data => {
        container.innerHTML = "";
        if (data.error) {
            container.innerHTML = `<p style="color:red;">${data.error}</p>`;
            return;
        }
        data.forEach(vid => {
            container.innerHTML += `
                <div style="margin-bottom: 20px;">
                    <a href="${vid.videoUrl}" target="_blank" style="text-decoration: none; color: black;">
                        <img src="${vid.thumbnail}" width="320" style="border-radius: 8px;"><br>
                        <strong>${vid.title}</strong>
                    </a>
                </div>
            `;
        });
    })
    .catch(() => {
        container.innerHTML = "<p style='color:red;'>Something went wrong while fetching highlights.</p>";
    });
}

    function convertToSpeech() {
    const text = document.getElementById("tts-input").value.trim();
    const audio = document.getElementById("tts-audio");

    if (!text) {
        alert("Please enter some text to convert to speech.");
        return;
    }

    fetch("/text-to-speech", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ text: text })
    })
    .then(res => res.json())
    .then(data => {
        if (data.audio) {
            audio.src = "data:audio/mp3;base64," + data.audio;
            audio.play();
        } else {
            alert("Error: " + data.error);
        }
    })
    .catch(() => {
        alert("Something went wrong while processing the speech request.");
    });
}

function getPlacesByCity() {
    const city = document.getElementById("cityInput").value;
    const keyword = document.getElementById("cityKeywordInput").value;

    fetch("/get_places_by_city", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ city, keyword })
    })
    .then(res => res.json())
    .then(data => {
        const list = document.getElementById("cityResultsList");
        list.innerHTML = "";

        if (data.error) {
            list.innerHTML = `<li>${data.error}</li>`;
            return;
        }

        if (data.length === 0) {
            list.innerHTML = "<li>No places found.</li>";
            return;
        }

        data.forEach(place => {
            const item = document.createElement("li");
            item.textContent = `${place.name} - ${place.address || "Address not available"} (Rating: ${place.rating || "N/A"})`;
            list.appendChild(item);
        });
    });
}

</script>
</body>
</html>
